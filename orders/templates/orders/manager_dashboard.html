
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manager Dashboard - {{ branch_name }}</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .navbar { background-color: #ffffff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .navbar-brand { font-weight: 700; color: #2c3e50; }
        
        .stat-card { transition: transform 0.2s; border: none; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .stat-card:hover { transform: translateY(-5px); }
        .card-icon { font-size: 2rem; opacity: 0.8; }
        
        .table-card { border: none; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); overflow: hidden; }
        .table th { background-color: #f1f3f5; font-weight: 600; border: none; }
        
        .status-badge { padding: 5px 10px; border-radius: 20px; font-size: 0.85rem; font-weight: 500; }
        .status-pending { background-color: #fff3cd; color: #856404; }
        .status-processing { background-color: #cce5ff; color: #004085; }
        .status-delivered { background-color: #d4edda; color: #155724; }
        .status-cancelled { background-color: #f8d7da; color: #721c24; }
        
        .btn-custom { border-radius: 20px; padding: 5px 15px; }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light sticky-top px-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"><i class="fas fa-clinic-medical text-primary me-2"></i>Mahmood Pharmacy</a>
            <div class="d-flex align-items-center">
                <span class="me-3 d-none d-md-block text-muted">Welcome, {{ request.user.first_name }} ({{ branch_name }})</span>
                <a href="/admin/" class="btn btn-outline-primary btn-sm"><i class="fas fa-arrow-left me-1"></i> Back to Admin</a>
                <a href="/admin/logout/" class="btn btn-outline-danger btn-sm ms-2"><i class="fas fa-sign-out-alt"></i></a>
            </div>
        </div>
    </nav>

    <div class="container-fluid py-4 px-4">
        
        <!-- Stats Row -->
        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="card stat-card bg-primary text-white h-100">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-0">Total Revenue</h6>
                            <h2 class="mt-2 mb-0">Rs. {{ total_revenue }}</h2>
                        </div>
                        <i class="fas fa-dollar-sign card-icon"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card bg-warning text-dark h-100">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-0">Pending Orders</h6>
                            <h2 class="mt-2 mb-0">{{ pending_orders }}</h2>
                        </div>
                        <i class="fas fa-clock card-icon"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card bg-success text-white h-100">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-0">Completed Orders</h6>
                            <h2 class="mt-2 mb-0">{{ completed_orders }}</h2>
                        </div>
                        <i class="fas fa-check-circle card-icon"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card bg-info text-white h-100">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-0">Total Orders</h6>
                            <h2 class="mt-2 mb-0">{{ total_orders }}</h2>
                        </div>
                        <i class="fas fa-shopping-bag card-icon"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters & Table -->
        <div class="card table-card">
            <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                <h5 class="mb-0 fw-bold">Recent Orders</h5>
                
                <form method="get" class="d-flex">
                    <select name="status" class="form-select form-select-sm me-2" style="width: 150px;">
                        <option value="">All Statuses</option>
                        <option value="Pending" {% if request.GET.status == 'Pending' %}selected{% endif %}>Pending</option>
                        <option value="Processing" {% if request.GET.status == 'Processing' %}selected{% endif %}>Processing</option>
                        <option value="Delivered" {% if request.GET.status == 'Delivered' %}selected{% endif %}>Delivered</option>
                        <option value="Cancelled" {% if request.GET.status == 'Cancelled' %}selected{% endif %}>Cancelled</option>
                    </select>
                    <button type="submit" class="btn btn-primary btn-sm">Filter</button>
                    {% if request.GET.status %}
                        <a href="?" class="btn btn-secondary btn-sm ms-1">Reset</a>
                    {% endif %}
                </form>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead>
                            <tr>
                                <th class="ps-4">Order ID</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Amount</th>
                                <th>Payment</th>
                                <th>Status</th>
                                <th class="text-end pe-4">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in orders %}
                            <tr>
                                <td class="ps-4 fw-bold">#{{ order.id }}</td>
                                <td>
                                    <div>{{ order.user.first_name }} {{ order.user.last_name }}</div>
                                    <div class="text-muted small">{{ order.user.email }}</div>
                                </td>
                                <td>{{ order.created_at|date:"M d, Y H:i" }}</td>
                                <td class="fw-bold">Rs. {{ order.total_amount }}</td>
                                <td><span class="badge bg-light text-dark border">{{ order.payment_method }}</span></td>
                                <td>
                                    <span class="status-badge 
                                        {% if order.status == 'Pending' %}status-pending{% endif %}
                                        {% if order.status == 'Processing' %}status-processing{% endif %}
                                        {% if order.status == 'Delivered' %}status-delivered{% endif %}
                                        {% if order.status == 'Cancelled' %}status-cancelled{% endif %}
                                    ">
                                        {{ order.status }}
                                    </span>
                                </td>
                                <td class="text-end pe-4">
                                    <a href="/admin/orders/order/{{ order.id }}/change/" class="btn btn-outline-secondary btn-sm btn-custom">View</a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="7" class="text-center py-5 text-muted">
                                    <i class="fas fa-box-open fa-3x mb-3 opacity-25"></i>
                                    <p>No orders found.</p>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% if is_paginated %}
            <div class="card-footer bg-white d-flex justify-content-center">
                 <ul class="pagination mb-0">
                    {% if page_obj.has_previous %}
                        <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a></li>
                    {% endif %}
                    <li class="page-item disabled"><span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span></li>
                    {% if page_obj.has_next %}
                        <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a></li>
                    {% endif %}
                </ul>
            </div>
            {% endif %}
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
